<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produtos - AlphaSports</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="container top-bar-content">
            <span>Frete grátis para todos os produtos</span>
            <span>Atendimento: (42) 99837-9401</span>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container header-content">
            <a href="index.html" class="logo">
                <img src="/images/Logo.png" alt="AlphaSports">
            </a>

            <div class="search-bar">
                <input type="text" placeholder="Buscar produtos..." id="searchInput">
                <button class="search-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
                </button>
            </div>

            <nav class="header-nav">
                <div class="nav-link user-dropdown-container" id="userInfo">
                    <a href="login.html" class="nav-link user-link" id="userLink">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                        <span id="userName">Entrar</span>
                    </a>

                </div>
                <a href="carrinho.html" class="nav-link cart-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="21" r="1"></circle><circle cx="19" cy="21" r="1"></circle><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"></path></svg>
                    <span>Carrinho</span>
                    <span class="cart-count" id="cartCount">0</span>
                </a>

                <a href="#" onclick="fazerLogout(event)"  class="nav-link cart-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                    Sair
                </a>

            </nav>

            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg>
            </button>
        </div>

        <!-- Categories Nav -->
        <nav class="categories-nav">
            <div class="container">
                <ul class="categories-list">
                    <li><a href="produtos.html?categoria=todos">Todos</a></li>
                    <li><a href="produtos.html?categoria=calcados">Calçados</a></li>
                    <li><a href="produtos.html?categoria=roupas">Roupas</a></li>
                    <li><a href="produtos.html?categoria=equipamentos">Equipamentos</a></li>
                    <li><a href="produtos.html?categoria=futebol">Futebol</a></li>
                    <li><a href="produtos.html?categoria=corrida">Corrida</a></li>
                    <li><a href="produtos.html?categoria=fitness">Fitness</a></li>
                    <li><a href="produtos.html" class="promo-link">Promoções</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main class="products-page">
        <div class="container">
            <div class="products-layout">
                <!-- Filters Sidebar -->
                <aside class="filters-sidebar">
                    <div class="filter-section">
                        <h3>Categorias</h3>
                        <div class="filter-options" id="categoryFilters">
                            <!-- Generated by JS -->
                        </div>
                    </div>

                    <div class="filter-section">
                        <h3>Marcas</h3>
                        <div class="filter-options" id="brandFilters">
                            <!-- Generated by JS -->
                        </div>
                    </div>

                    <div class="filter-section">
                        <h3>Preço</h3>
                        <div class="price-range">
                            <div class="price-input">
                                <input type="number" placeholder="Min" id="priceMin">
                            </div>
                            <span>-</span>
                            <div class="price-input">
                                <input type="number" placeholder="Max" id="priceMax">
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" style="width: 100%;" onclick="applyFilters()">Aplicar Filtros</button>
                </aside>

                <!-- Products Content -->
                <div class="products-content">
                    <div class="products-header">
                        <span class="results-count" id="resultsCount">12 produtos encontrados</span>
                        <select class="sort-select" id="sortSelect" onchange="sortProducts()">
                            <option value="relevance">Mais relevantes</option>
                            <option value="price-asc">Menor preço</option>
                            <option value="price-desc">Maior preço</option>
                            <option value="rating">Melhor avaliação</option>
                        </select>
                    </div>

                    <div class="products-list" id="productsList">
                        <!-- Generated by JS -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <img src="/images/Logo.png" alt="AlphaSports" class="footer-logo">
                    <p>Sua loja de artigos esportivos com as melhores marcas e preços.</p>
                </div>
                <div class="footer-col">
                    <h4>Institucional</h4>
                    <ul>
                        <li><a href="#">Sobre Nós</a></li>
                        <li><a href="#">Nossas Lojas</a></li>
                        <li><a href="#">Trabalhe Conosco</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Ajuda</h4>
                    <ul>
                        <li><a href="#">Central de Atendimento</a></li>
                        <li><a href="#">Trocas e Devoluções</a></li>
                        <li><a href="#">Prazo de Entrega</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Minha Conta</h4>
                    <ul>
                        <li><a href="login.html">Entrar</a></li>
                        <li><a href="cadastro.html">Cadastrar</a></li>
                        <li><a href="carrinho.html">Carrinho</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 AlphaSports. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="data.js"></script>
    <script src="script.js"></script>
    <script>

        async function atualizarHeader() {
            try {
                const response = await fetch('http://localhost:2022/api/auth/verificar', {
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    const primeiroNome = data.nome.split(' ')[0];

                    // 1. Atualizar o texto do Desktop (verifica se existe antes)
                    const userName = document.getElementById('userName');
                    if (userName) userName.textContent = `Olá, ${primeiroNome}`;

                    // 2. Atualizar o link do Desktop
                    const userLink = document.getElementById('userLink');
                    if (userLink) {
                        userLink.href = 'perfil.html';

                        // FORMA INFALÍVEL: Remove qualquer evento de clique anterior clonando o botão
                        const novoLink = userLink.cloneNode(true);
                        userLink.parentNode.replaceChild(novoLink, userLink);
                    }

                    // 3. Atualizar o Mobile (SÓ se o elemento existir no HTML)
                    const mobileUserLink = document.getElementById('mobileUserLink');
                    if (mobileUserLink) {
                        mobileUserLink.textContent = `Olá, ${primeiroNome}`;
                        mobileUserLink.href = 'perfil.html';
                    }
                }
            } catch (error) {
                console.error('Erro ao verificar autenticação:', error);
            }
        }

        function toggleMenuUsuario() {
            const dropdown = document.getElementById('userDropdown');
            if (dropdown) {
                dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
            }
        }

        // Função de logout
        async function fazerLogout(event) {
            event.preventDefault();

            try {
                const response = await fetch('http://localhost:2022/api/auth/logout', {
                    method: 'POST',
                    credentials: 'include'
                });

                if (response.ok) {
                    localStorage.removeItem('alphasports_user');
                    if (typeof showToast === 'function') {
                        showToast('Logout realizado com sucesso!', 'success');
                    }
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1000);
                }
            } catch (error) {
                console.error('Erro ao fazer logout:', error);
            }
        }

        atualizarHeader();


        let filteredProducts = [...products];
        let activeCategory = null;
        let activeBrand = null;

        function initFilters() {
            // Get URL params
            const params = new URLSearchParams(window.location.search);
            activeCategory = params.get('categoria');
            activeBrand = params.get('marca');

            // Render category filters
            const categoryFilters = document.getElementById('categoryFilters');
            categoryFilters.innerHTML = categories.map(cat => `
                <label class="filter-option">
                    <input type="checkbox" name="category" value="${cat.id}" ${activeCategory === cat.id ? 'checked' : ''}>
                    <span>${cat.name}</span>
                    <span class="filter-count">(${cat.count})</span>
                </label>
            `).join('');

            // Render brand filters
            const brandFilters = document.getElementById('brandFilters');
            brandFilters.innerHTML = brands.map(brand => `
                <label class="filter-option">
                    <input type="checkbox" name="brand" value="${brand.id}" ${activeBrand === brand.id ? 'checked' : ''}>
                    <span>${brand.name}</span>
                    <span class="filter-count">(${brand.count})</span>
                </label>
            `).join('');

            applyFilters();
        }

        function applyFilters() {
            const categoryCheckboxes = document.querySelectorAll('input[name="category"]:checked');
            const brandCheckboxes = document.querySelectorAll('input[name="brand"]:checked');
            const priceMin = parseFloat(document.getElementById('priceMin').value) || 0;
            const priceMax = parseFloat(document.getElementById('priceMax').value) || Infinity;

            const selectedCategories = Array.from(categoryCheckboxes).map(cb => cb.value);
            const selectedBrands = Array.from(brandCheckboxes).map(cb => cb.value);

            filteredProducts = products.filter(product => {
                const categoryMatch = selectedCategories.length === 0 || selectedCategories.includes(product.category);
                const brandMatch = selectedBrands.length === 0 || selectedBrands.includes(product.brand.toLowerCase().replace(' ', '-'));
                const priceMatch = product.price >= priceMin && product.price <= priceMax;
                return categoryMatch && brandMatch && priceMatch;
            });

            sortProducts();
        }

        function sortProducts() {
            const sortValue = document.getElementById('sortSelect').value;

            switch(sortValue) {
                case 'price-asc':
                    filteredProducts.sort((a, b) => a.price - b.price);
                    break;
                case 'price-desc':
                    filteredProducts.sort((a, b) => b.price - a.price);
                    break;
                case 'rating':
                    filteredProducts.sort((a, b) => b.rating - a.rating);
                    break;
                default:
                    filteredProducts.sort((a, b) => (b.isBestSeller ? 1 : 0) - (a.isBestSeller ? 1 : 0));
            }

            renderProducts();
        }

        function renderProducts() {
            const productsList = document.getElementById('productsList');
            const resultsCount = document.getElementById('resultsCount');

            resultsCount.textContent = `${filteredProducts.length} produtos encontrados`;

            if (filteredProducts.length === 0) {
                productsList.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 4rem 2rem;">
                        <h3>Nenhum produto encontrado</h3>
                        <p style="color: var(--gray-600); margin-top: 0.5rem;">Tente ajustar os filtros</p>
                    </div>
                `;
                return;
            }

            productsList.innerHTML = filteredProducts.map(createProductCard).join('');
        }

        document.addEventListener('DOMContentLoaded', initFilters);
    </script>
</body>
</html>
